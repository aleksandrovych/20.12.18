{"version":3,"sources":["../src/index.js"],"names":["React","PureComponent","PropTypes","styles","position","bottom","right","width","height","overflow","opacity","ImageMeasurer","makeItemsWithSizes","items","sizes","reduce","res","item","stop","src","props","image","size","itemsWithSizes","push","timeouts","state","onLoad","ref","clearTimeout","offsetWidth","offsetHeight","setState","onLoadError","event","onError","getDefaultSize","timeout","setTimeout","setDefaultSize","defaultWidth","defaultHeight","forEach","keyMapper","children","map","index","target","displayName","propTypes","func","number","isRequired","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import React, {PureComponent} from \"react\";\nimport PropTypes from \"prop-types\";\n\nconst styles = {\n    position: \"absolute\",\n    bottom: \"0\",\n    right: \"0\",\n    width: \"1px\",\n    height: \"1px\",\n    overflow: \"hidden\",\n    opacity: 0\n};\n\nexport default class ImageMeasurer extends PureComponent {\n\n    static displayName = \"ImageMeasurer\";\n\n    static propTypes = {\n        onError: PropTypes.func,\n        timeout: PropTypes.number,\n        keyMapper: PropTypes.func,\n        image: PropTypes.func.isRequired,\n        children: PropTypes.func.isRequired,\n        defaultWidth: PropTypes.number.isRequired,\n        defaultHeight: PropTypes.number.isRequired\n    };\n\n    static defaultProps = {\n        onError: () => null,\n        timeout: 5000,\n        keyMapper: () => null\n    };\n\n    makeItemsWithSizes = (items, sizes) => items.reduce((res, item) => {\n\n        if (res.stop) return res;\n\n        const src = this.props.image(item);\n        const size = sizes[src];\n\n        // this will stop execution for first non-loaded image\n        if (src && !size) {\n            return {...res, stop: true};\n        }\n\n        res.itemsWithSizes.push({\n            item,\n            size\n        });\n\n        return res;\n\n    }, {itemsWithSizes: [], stop: false}).itemsWithSizes;\n\n    timeouts = {};\n\n    state = {\n        sizes: {}\n    };\n\n    onLoad = (src, ref) => {\n\n        this.clearTimeout(src);\n\n        if (this.state.sizes[src]) return;\n\n        const size = {\n            width: ref.offsetWidth,\n            height: ref.offsetHeight\n        };\n\n        const sizes = {\n            ...this.state.sizes,\n            [src]: size\n        };\n\n        this.setState({sizes});\n\n    };\n\n    onLoadError = (event, item, src) => {\n        this.onLoad(src, this.props.onError(event, item, src) || this.getDefaultSize());\n    };\n\n    clearTimeout = (src) => {\n        const timeout = this.timeouts[src];\n        if (timeout) clearTimeout(timeout);\n    };\n\n    setTimeout = (src) => {\n        this.clearTimeout(src);\n        setTimeout(() => {\n            this.setDefaultSize(src);\n        }, this.props.timeout);\n    };\n\n    getDefaultSize = () => ({\n        width: this.props.defaultWidth,\n        height: this.props.defaultHeight\n    });\n\n    setDefaultSize = (src) => {\n        this.onLoad(src, this.getDefaultSize());\n    };\n\n    componentDidUpdate() {\n\n        const {items, image} = this.props;\n\n        items.forEach(item => {\n\n            const src = image(item);\n\n            if (!!this.timeouts[src] || this.state.sizes[src]) return;\n\n            if (!src) {\n                this.setDefaultSize(src);\n                return;\n            }\n\n            this.setTimeout(src);\n\n        })\n\n    }\n\n    render() {\n\n        const {items, image, keyMapper, children, defaultWidth, defaultHeight, onError, timeout, ...props} = this.props;\n        const {sizes} = this.state;\n\n        const itemsWithSizes = this.makeItemsWithSizes(items, sizes);\n\n        return (\n            <div {...props}>\n\n                <span style={styles}>\n                    {items.map((item, index) => {\n\n                        const src = image(item);\n\n                        if (!src) return null;\n\n                        return (\n                            <img\n                                key={keyMapper(item, index) || index}\n                                src={src}\n                                alt={src}\n                                onLoad={event => this.onLoad(src, event.target)}\n                                onError={event => this.onLoadError(event, item, src)}\n                            />\n                        );\n\n                    })}\n                </span>\n\n                {children({itemsWithSizes, sizes})}\n\n            </div>\n        );\n\n    }\n}\n"]}