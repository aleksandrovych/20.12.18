{"ast":null,"code":"import _objectWithoutProperties from \"babel-runtime/helpers/objectWithoutProperties\";\nimport _defineProperty from \"babel-runtime/helpers/defineProperty\";\nimport _extends from \"babel-runtime/helpers/extends\";\nimport _Object$getPrototypeOf from \"babel-runtime/core-js/object/get-prototype-of\";\nimport _classCallCheck from \"babel-runtime/helpers/classCallCheck\";\nimport _createClass from \"babel-runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"babel-runtime/helpers/possibleConstructorReturn\";\nimport _inherits from \"babel-runtime/helpers/inherits\";\nvar _jsxFileName = \"src/index.js\";\nimport React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nvar styles = {\n  position: \"absolute\",\n  bottom: \"0\",\n  right: \"0\",\n  width: \"1px\",\n  height: \"1px\",\n  overflow: \"hidden\",\n  opacity: 0\n};\n\nvar ImageMeasurer = function (_PureComponent) {\n  _inherits(ImageMeasurer, _PureComponent);\n\n  function ImageMeasurer() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, ImageMeasurer);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = ImageMeasurer.__proto__ || _Object$getPrototypeOf(ImageMeasurer)).call.apply(_ref, [this].concat(args))), _this), _this.makeItemsWithSizes = function (items, sizes) {\n      return items.reduce(function (res, item) {\n        if (res.stop) return res;\n\n        var src = _this.props.image(item);\n\n        var size = sizes[src]; // this will stop execution for first non-loaded image\n\n        if (src && !size) {\n          return _extends({}, res, {\n            stop: true\n          });\n        }\n\n        res.itemsWithSizes.push({\n          item: item,\n          size: size\n        });\n        return res;\n      }, {\n        itemsWithSizes: [],\n        stop: false\n      }).itemsWithSizes;\n    }, _this.timeouts = {}, _this.state = {\n      sizes: {}\n    }, _this.onLoad = function (src, ref) {\n      _this.clearTimeout(src);\n\n      if (_this.state.sizes[src]) return;\n      var size = {\n        width: ref.offsetWidth,\n        height: ref.offsetHeight\n      };\n\n      var sizes = _extends({}, _this.state.sizes, _defineProperty({}, src, size));\n\n      _this.setState({\n        sizes: sizes\n      });\n    }, _this.onLoadError = function (event, item, src) {\n      _this.onLoad(src, _this.props.onError(event, item, src) || _this.getDefaultSize());\n    }, _this.clearTimeout = function (src) {\n      var timeout = _this.timeouts[src];\n      if (timeout) clearTimeout(timeout);\n    }, _this.setTimeout = function (src) {\n      _this.clearTimeout(src);\n\n      setTimeout(function () {\n        _this.setDefaultSize(src);\n      }, _this.props.timeout);\n    }, _this.getDefaultSize = function () {\n      return {\n        width: _this.props.defaultWidth,\n        height: _this.props.defaultHeight\n      };\n    }, _this.setDefaultSize = function (src) {\n      _this.onLoad(src, _this.getDefaultSize());\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(ImageMeasurer, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this2 = this;\n\n      var _props = this.props,\n          items = _props.items,\n          image = _props.image;\n      items.forEach(function (item) {\n        var src = image(item);\n        if (!!_this2.timeouts[src] || _this2.state.sizes[src]) return;\n\n        if (!src) {\n          _this2.setDefaultSize(src);\n\n          return;\n        }\n\n        _this2.setTimeout(src);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _props2 = this.props,\n          items = _props2.items,\n          image = _props2.image,\n          keyMapper = _props2.keyMapper,\n          children = _props2.children,\n          defaultWidth = _props2.defaultWidth,\n          defaultHeight = _props2.defaultHeight,\n          onError = _props2.onError,\n          timeout = _props2.timeout,\n          props = _objectWithoutProperties(_props2, [\"items\", \"image\", \"keyMapper\", \"children\", \"defaultWidth\", \"defaultHeight\", \"onError\", \"timeout\"]);\n\n      var sizes = this.state.sizes;\n      var itemsWithSizes = this.makeItemsWithSizes(items, sizes);\n      return React.createElement(\"div\", _extends({}, props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        }\n      }), React.createElement(\"span\", {\n        style: styles,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        }\n      }, items.map(function (item, index) {\n        var src = image(item);\n        if (!src) return null;\n        return React.createElement(\"img\", {\n          key: keyMapper(item, index) || index,\n          src: src,\n          alt: src,\n          onLoad: function onLoad(event) {\n            return _this3.onLoad(src, event.target);\n          },\n          onError: function onError(event) {\n            return _this3.onLoadError(event, item, src);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          }\n        });\n      })), children({\n        itemsWithSizes: itemsWithSizes,\n        sizes: sizes\n      }));\n    }\n  }]);\n\n  return ImageMeasurer;\n}(PureComponent);\n\nImageMeasurer.displayName = \"ImageMeasurer\";\nImageMeasurer.propTypes = {\n  onError: PropTypes.func,\n  timeout: PropTypes.number,\n  keyMapper: PropTypes.func,\n  image: PropTypes.func.isRequired,\n  children: PropTypes.func.isRequired,\n  defaultWidth: PropTypes.number.isRequired,\n  defaultHeight: PropTypes.number.isRequired\n};\nImageMeasurer.defaultProps = {\n  onError: function onError() {\n    return null;\n  },\n  timeout: 5000,\n  keyMapper: function keyMapper() {\n    return null;\n  }\n};\nexport default ImageMeasurer;","map":null,"metadata":{},"sourceType":"module"}